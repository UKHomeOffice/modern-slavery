'use strict';

/**
 * Check if at least one option has been selected
 *
 * @param {*} values - list of form values
 *
 * @returns {bool} - If an option has been selected
 */
const isAtLeastOneOptionSelected = values => {
  const exploitationSelectionValid = Object.keys(values).some(key => {
    if (key.indexOf('types-of-exploitation') > -1) {
      const option = values[`${key}`];
      return option;
    }
    return false;
  });
  return exploitationSelectionValid;
};

module.exports = superclass => class extends superclass {
  validate(req, res, next) {
    const { values } = req.form;

    if (!isAtLeastOneOptionSelected(values)) {
      return next({
        'types-of-exploitation-forced-to-work': new this.ValidationError('types-of-exploitation-forced-to-work', {
          key: 'types-of-exploitation-forced-to-work',
          type: 'at-least-one-option-selected'
        })
      });
    }
    req.sessionModel.set('types-of-exploitation', true);
    return super.validate(req, res, next);
  }

  // saveValues(req, res, next) {
  //   // save labels of selected types of exploitation values in an array that can be used on summary pages
  //   let forcedToWork;
  //   let wagesTaken;
  //   let forcedToCommitFraud;
  //   let prostitution;
  //   let childExploitation;
  //   let takenSomewhere;
  //   let forcedToCommitCrime;
  //   let organsRemoved;
  //   let unpaidHouseholdWork;

  //   if (req.form.values['types-of-exploitation-forced-to-work']) {
  //     forcedToWork = 'Forced to work for nothing or almost nothing';
  //   }
  //   if (req.form.values['types-of-exploitation-wages-taken']) {
  //     wagesTaken = 'Wages taken by force or coercion, such as through control of a bank account';
  //   }
  //   if (req.form.values['types-of-exploitation-forced-to-commit-fraud']) {
  //     forcedToCommitFraud = 'Forced to commit fraud, such as using their identity to claim benefits';
  //   }
  //   if (req.form.values['types-of-exploitation-prostitution']) {
  //     prostitution = 'Forced into prostitution';
  //   }
  //   if (req.form.values['types-of-exploitation-child-exploitation']) {
  //     childExploitation = 'Child sexual exploitation';
  //   }
  //   if (req.form.values['types-of-exploitation-taken-somewhere']) {
  //     takenSomewhere = 'Taken somewhere, held against their will and sexually assaulted';
  //   }
  //   if (req.form.values['types-of-exploitation-forced-to-commit-crime']) {
  //     forcedToCommitCrime = 'Forced to commit a crime, such as growing cannabis, drug dealing or begging';
  //   }
  //   if (req.form.values['types-of-exploitation-organs-removed']) {
  //     organsRemoved = 'Organs, such as kidneys, removed against their will';
  //   }
  //   if (req.form.values['types-of-exploitation-unpaid-household-work']) {
  //     unpaidHouseholdWork = 'Forced to do unpaid or low paid household work by relatives or strangers';
  //   }
  //   req.form.values['exploitation-types'] = [
  //     forcedToWork,
  //     wagesTaken,
  //     forcedToCommitFraud,
  //     prostitution,
  //     childExploitation,
  //     takenSomewhere,
  //     forcedToCommitCrime,
  //     organsRemoved,
  //     unpaidHouseholdWork,
  //     req.form.values['other-exploitation-details']
  //   ].filter(Boolean);
  //   return super.saveValues(req, res, next);
  // }
};
