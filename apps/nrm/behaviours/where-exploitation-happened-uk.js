'use strict';

module.exports = superclass => class extends superclass {
  locals(req, res) {
    const superlocals = super.locals(req, res);

    let data = {};

    if (req.sessionModel.get('where-exploitation-happened') === 'uk-and-overseas') {
      data = Object.assign({}, data, { UkAndOverseas: true });
    }

    const locals = Object.assign({}, superlocals, data);

    return locals;
  }

  saveValues(req, res, next) {
    if (req.sessionModel.get('where-exploitation-happened') === 'uk-and-overseas') {
      req.form.options.continueOnEdit = true;
    }

    // save where-exploitation-happened-uk city values in an array that can be used on summary pages
    req.form.values['uk-exploitation'] = [
      req.form.values['where-exploitation-happened-uk-city-1'],
      req.form.values['where-exploitation-happened-uk-city-2'],
      req.form.values['where-exploitation-happened-uk-city-3'],
      req.form.values['where-exploitation-happened-uk-city-4'],
      req.form.values['where-exploitation-happened-uk-city-5'],
      req.form.values['where-exploitation-happened-uk-city-6'],
      req.form.values['where-exploitation-happened-uk-city-7'],
      req.form.values['where-exploitation-happened-uk-city-8'],
      req.form.values['where-exploitation-happened-uk-city-9'],
      req.form.values['where-exploitation-happened-uk-city-10']
    ].filter(Boolean);
    return super.saveValues(req, res, next);
  }
};
